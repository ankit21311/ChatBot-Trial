<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TinyLlama Chatbot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0f172a; --card:#111827; --bot:#1f2937; --user:#2563eb; --text:#e5e7eb; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);font-family:system-ui,Arial}
    .wrap{max-width:760px;margin:24px auto;padding:16px}
    .card{background:var(--card);border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.35);overflow:hidden}
    .header{padding:16px 20px;color:var(--text);border-bottom:1px solid #1f2937}
    #chat{height:60vh;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:10px}
    .msg{padding:12px 14px;border-radius:14px;max-width:85%;line-height:1.4;color:#fff;white-space:pre-wrap}
    .bot{background:var(--bot);align-self:flex-start;border-top-left-radius:4px}
    .user{background:var(--user);align-self:flex-end;border-top-right-radius:4px}
    .input-row{display:flex;gap:10px;padding:12px;border-top:1px solid #1f2937;background:#0b1220}
    input,button{font-size:16px}
    input{flex:1;padding:12px 14px;border-radius:10px;border:1px solid #334155;background:#0b1220;color:var(--text)}
    button{padding:12px 16px;border-radius:10px;border:0;background:#22c55e;color:#052e16;font-weight:700;cursor:pointer}
    button:disabled{opacity:.5;cursor:not-allowed}
    .hint{color:#9ca3af;font-size:12px;padding:0 16px 12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="header"><strong>TinyLlama Chatbot</strong> · local GGUF</div>
      <div id="chat"></div>
      <div class="hint">Educational only — not medical advice.</div>
      <div class="input-row">
        <input id="prompt" placeholder="Type a message… (e.g., What is diabetes?)" />
        <button id="send">Send</button>
      </div>
    </div>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const promptEl = document.getElementById('prompt');
    const sendBtn = document.getElementById('send');
    const history = []; // {role: "user"|"assistant", content: string}

    function push(role, text){
      const div = document.createElement('div');
      div.className = 'msg ' + (role === 'assistant' ? 'bot' : 'user');
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
      history.push({role, content: text});
    }

    async function send(){
      const text = promptEl.value.trim();
      if (!text) return;
      promptEl.value = '';
      sendBtn.disabled = true;
      push('user', text);

      try{
        const res = await fetch('/chat', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ message: text, history })
        });
        const data = await res.json();
        push('assistant', data.reply || '(no reply)');
      }catch(e){
        push('assistant', 'Error contacting server.');
      }finally{
        sendBtn.disabled = false;
        promptEl.focus();
      }
    }

    sendBtn.addEventListener('click', send);
    promptEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ send(); }});
    // greet
    push('assistant', 'Hi! I’m Metabolical Chatbot. Ask me anything related to Metabolical News (general info only).');
  </script>
</body>
</html>
